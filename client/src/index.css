@import url('https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Nunito+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500;700&display=swap');
@import "tailwindcss";

@theme {
  /* ═══════════════════════════════════════════════════════
     AXIOMS — the entire design system derives from these.
     Change an axiom, everything downstream recalculates.
     ═══════════════════════════════════════════════════════ */

  --base-size: 1rem;           /* 16px. Browser default, WCAG SC 1.4.4 */
  --type-ratio: 1.25;          /* Major third (Tim Brown) */
  --space-unit: 0.5rem;        /* 8px. Universal grid constant */
  --phi: 1.618034;             /* Golden ratio */
  --timing-base: 200ms;        /* Nielsen/Miller perceptual threshold */
  --lum-bg: 0.14;              /* OKLCH base lightness */
  --lum-step: 0.035;           /* OKLCH elevation increment (Weber) */
  --surface-chroma: 0.02;      /* TUNABLE warm tint */
  --surface-hue: 55;           /* TUNABLE amber direction */
  --accent-hue: 85;            /* TUNABLE warm gold in OKLCH */
  --accent-lightness: 0.72;    /* TUNABLE accent base lightness */
  --accent-chroma: 0.14;       /* TUNABLE accent saturation */
  --plastic: 1.324718;         /* Van der Laan plastic constant */

  /* ═══════════════════════════════════════════════════════
     SPACING BASE — all numeric utilities are N × 8px
     ═══════════════════════════════════════════════════════ */

  --spacing: var(--space-unit);

  /* ═══════════════════════════════════════════════════════
     TYPE SCALE — base × ratio^n
     ═══════════════════════════════════════════════════════ */

  --font-size-*: initial;      /* Clear Tailwind defaults — forces derived scale */

  --font-size-nano: calc(var(--base-size) / var(--type-ratio) / var(--type-ratio) / var(--type-ratio));
  /* 0.512rem ≈ 8.2px. Decorative only */

  --font-size-micro: calc(var(--base-size) / var(--type-ratio) / var(--type-ratio));
  /* 0.64rem ≈ 10.2px. Badges, overlines */

  --font-size-caption: calc(var(--base-size) / var(--type-ratio));
  /* 0.8rem ≈ 12.8px. Labels, metadata */

  --font-size-body: var(--base-size);
  /* 1rem = 16px. Default body, inputs, chat */

  --font-size-subheading: calc(var(--base-size) * var(--type-ratio));
  /* 1.25rem = 20px. Card titles, nav brand */

  --font-size-heading: calc(var(--base-size) * var(--type-ratio) * var(--type-ratio));
  /* 1.5625rem ≈ 25px. Section headers, modal titles */

  --font-size-display: calc(var(--base-size) * var(--type-ratio) * var(--type-ratio) * var(--type-ratio));
  /* 1.953rem ≈ 31px. Page titles, stat callouts */

  --font-size-hero: calc(var(--base-size) * var(--type-ratio) * var(--type-ratio) * var(--type-ratio) * var(--type-ratio));
  /* 2.441rem ≈ 39px. Login title, treemap big numbers */

  /* ═══════════════════════════════════════════════════════
     COLORS — OKLCH with perceptually uniform elevation
     ═══════════════════════════════════════════════════════ */

  --color-bg:        oklch(var(--lum-bg) var(--surface-chroma) var(--surface-hue));
  --color-surface:   oklch(calc(var(--lum-bg) + var(--lum-step)) var(--surface-chroma) var(--surface-hue));
  --color-surface-2: oklch(calc(var(--lum-bg) + 2 * var(--lum-step)) var(--surface-chroma) var(--surface-hue));
  --color-surface-3: oklch(calc(var(--lum-bg) + 3 * var(--lum-step)) var(--surface-chroma) var(--surface-hue));

  --color-border:        oklch(calc(var(--lum-bg) + 1.5 * var(--lum-step)) var(--surface-chroma) var(--surface-hue));
  --color-border-subtle: oklch(calc(var(--lum-bg) + 0.75 * var(--lum-step)) var(--surface-chroma) var(--surface-hue));

  --color-text:           oklch(0.88 0.01 var(--surface-hue));
  --color-text-secondary: oklch(0.65 0.02 var(--surface-hue));
  --color-text-dim:       oklch(0.55 0.02 var(--surface-hue));

  /* Accent — derived from OKLCH axioms */
  --color-accent:       oklch(var(--accent-lightness) var(--accent-chroma) var(--accent-hue));
  --color-accent-hover: oklch(calc(var(--accent-lightness) + var(--lum-step)) var(--accent-chroma) var(--accent-hue));
  --color-accent-dim:   oklch(calc(var(--accent-lightness) - 2 * var(--lum-step)) var(--accent-chroma) var(--accent-hue));

  /* Semantic */
  --color-green: #5aad72;
  --color-red: #d4685a;
  --color-yellow: #e0b840;
  --color-blue: #6d9fd8;

  /* ═══════════════════════════════════════════════════════
     FONTS
     ═══════════════════════════════════════════════════════ */

  --font-display: 'Syne', system-ui, sans-serif;
  --font-body: 'Nunito Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', 'Courier New', monospace;

  /* ═══════════════════════════════════════════════════════
     BORDER RADIUS — derived from space-unit
     ═══════════════════════════════════════════════════════ */

  --radius-sm: calc(var(--space-unit) / 2);   /* 4px */
  --radius-md: var(--space-unit);             /* 8px */
  --radius-lg: calc(var(--space-unit) * 1.5); /* 12px */
  --radius-full: 9999px;

  /* ═══════════════════════════════════════════════════════
     OPACITY — Weber-Fechner geometric scale
     ═══════════════════════════════════════════════════════ */

  --opacity-1: 0.03;   /* grain, scanlines */
  --opacity-2: 0.055;  /* subtle hover */
  --opacity-3: 0.10;   /* disabled overlays */
  --opacity-4: 0.18;   /* treemap color-mix */
  --opacity-5: 0.33;   /* dimmed elements */
  --opacity-6: 0.60;   /* de-emphasized */
  --opacity-7: 1.0;

  /* ═══════════════════════════════════════════════════════
     TIMING — phi-derived duration scale
     ═══════════════════════════════════════════════════════ */

  --duration-instant: calc(var(--timing-base) / var(--phi) / var(--phi));  /* ~76ms */
  --duration-fast: calc(var(--timing-base) / var(--phi));                  /* ~124ms */
  --duration-normal: var(--timing-base);                                    /* 200ms */
  --duration-slow: calc(var(--timing-base) * var(--phi));                  /* ~324ms */
  --duration-slower: calc(var(--timing-base) * var(--phi) * var(--phi));   /* ~524ms */

  --ease-standard: cubic-bezier(0.2, 0, 0, 1);
  --ease-decelerate: cubic-bezier(0, 0, 0, 1);
  --ease-accelerate: cubic-bezier(0.3, 0, 1, 1);

  /* ═══════════════════════════════════════════════════════
     SHADOWS — OKLCH, derived from surface-hue
     ═══════════════════════════════════════════════════════ */

  --shadow-sm: 0 1px 3px oklch(0.05 0.01 var(--surface-hue) / 0.3), 0 1px 2px oklch(0.05 0.01 var(--surface-hue) / 0.2);
  --shadow-md: 0 4px 12px oklch(0.05 0.01 var(--surface-hue) / 0.4), 0 2px 4px oklch(0.05 0.01 var(--surface-hue) / 0.2);
  --shadow-lg: 0 12px 40px oklch(0.05 0.01 var(--surface-hue) / 0.5), 0 4px 12px oklch(0.05 0.01 var(--surface-hue) / 0.3);
  --shadow-glow: 0 0 20px oklch(0.65 0.15 85 / var(--opacity-2));

  /* ═══════════════════════════════════════════════════════
     TOUCH TARGETS — Fitts' law
     ═══════════════════════════════════════════════════════ */

  --target-min: 48px;

  /* ═══════════════════════════════════════════════════════
     LETTER SPACING — creates tracking-* utilities
     TUNABLE: Bringhurst recommends 5-12% for all-caps text
     at small sizes, 2-5% for display/brand text.
     ═══════════════════════════════════════════════════════ */

  --letter-spacing-overline: 0.1em;  /* TUNABLE — 10% em, mid-range for all-caps at nano/micro sizes */
  --letter-spacing-wide: 0.04em;     /* TUNABLE — 4% em, subtle enhancement for nav/brand at body size */

  /* ═══════════════════════════════════════════════════════
     CONTAINER MAX-WIDTHS — derived from space-unit.
     Each is N × 8px. Creates max-w-* utilities.
     ═══════════════════════════════════════════════════════ */

  --container-content: calc(var(--space-unit) * 150);
  /* 1200px = 150 × 8px. TUNABLE — roster page: fits 12-column data grid */

  --container-terminal: calc(var(--space-unit) * 85);
  /* 680px = 85 × 8px. TUNABLE — ~65ch at body size, optimal reading measure (Bringhurst) */

  --container-embed: calc(var(--space-unit) * 75);
  /* 600px = 75 × 8px. TUNABLE — embeds + modals: ~55ch comfortable minimum measure */

  --container-message: calc(var(--space-unit) * 88);
  /* 704px = 88 × 8px. TUNABLE — chat messages: wider than embeds for conversation flow */

  /* ═══════════════════════════════════════════════════════
     Z-INDEX — simplest integers for correct stacking.
     Grain overlay ::after = 1 (within its isolation context).
     ═══════════════════════════════════════════════════════ */

  --z-index-dropdown: 2;  /* Above grain (1) */
  --z-index-modal: 3;     /* Above dropdowns (2) */

  /* ═══════════════════════════════════════════════════════
     ANIMATIONS — durations from φ scale, easing from --ease-*.
     Creates animate-* utilities.
     ═══════════════════════════════════════════════════════ */

  --animate-fade-in: fadeIn var(--duration-fast) var(--ease-decelerate);
  /* Enter animation: φ⁻¹ × timing-base ≈ 124ms, decelerate for landing */

  --animate-alt-row-enter: fadeIn var(--duration-fast) var(--ease-decelerate) both;
  /* Alt-row stagger: reuses fadeIn, fill-mode:both holds opacity:0 during delay */

  --animate-pulse-slow: pulse calc(var(--timing-base) * var(--phi) * var(--phi) * var(--phi) * var(--phi)) var(--ease-standard) infinite;
  /* Reconnection pulse: φ⁴ × timing-base ≈ 1371ms, standard ease */

  /* ═══════════════════════════════════════════════════════
     ASPECT RATIOS — creates aspect-* utilities.
     ═══════════════════════════════════════════════════════ */

  --aspect-treemap: 2/1;
  /* TUNABLE — landscape gives treemap cells room for labels + counts
     without excessive vertical scroll */

  --aspect-treemap-mobile: 3/2;
  /* TUNABLE — taller on narrow screens to prevent cells from
     becoming too wide and flat */
}

/* ── Base styles (in Tailwind's base layer) ────────────── */

@layer base {
  body {
    font-family: var(--font-body);
    background: var(--color-bg);
    color: var(--color-text);
    height: 100vh;
    display: flex;
    flex-direction: column;
    font-size: var(--font-size-body);
  }

  #root {
    display: flex;
    flex-direction: column;
    height: 100vh;
  }

  /* ── Scrollbar — thin, token-driven ──────────────────── */

  /* Firefox / standards */
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--color-surface-3) transparent;
  }

  /* WebKit (Chrome, Safari, Edge) */
  ::-webkit-scrollbar {
    width: var(--space-unit);  /* 8px */
    height: var(--space-unit);
  }
  ::-webkit-scrollbar-track {
    background: transparent;
  }
  ::-webkit-scrollbar-thumb {
    background: var(--color-surface-3);
    border-radius: var(--radius-full);
  }
  ::-webkit-scrollbar-thumb:hover {
    background: var(--color-text-dim);
  }
  ::-webkit-scrollbar-corner {
    background: transparent;
  }
}

/* ── Range slider (layered so Tailwind utilities still win) ─ */

@layer components {
  .range-thumb::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 9999px;
    background: var(--color-accent);
    border: 2px solid var(--color-bg);
    cursor: pointer;
    pointer-events: auto;
    transition: transform var(--duration-fast) var(--ease-standard),
                box-shadow var(--duration-fast) var(--ease-standard);
  }
  .range-thumb::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 0 0 3px oklch(var(--accent-lightness) var(--accent-chroma) var(--accent-hue) / 0.25);
  }
  .range-thumb::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 9999px;
    background: var(--color-accent);
    border: 2px solid var(--color-bg);
    cursor: pointer;
    pointer-events: auto;
    transition: transform var(--duration-fast) var(--ease-standard),
                box-shadow var(--duration-fast) var(--ease-standard);
  }
  .range-thumb::-moz-range-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 0 0 3px oklch(var(--accent-lightness) var(--accent-chroma) var(--accent-hue) / 0.25);
  }
  .range-thumb::-webkit-slider-runnable-track {
    background: transparent;
    height: 0;
  }
  .range-thumb::-moz-range-track {
    background: transparent;
    height: 0;
  }
}

/* ── Pip color classes (data-driven, keep as unlayered CSS) */

.pip-cleric { background: #f0c040; }
.pip-warrior { background: #d4ad80; }
.pip-wizard { background: #69ccf0; }
.pip-magician { background: #40b8b0; }
.pip-enchanter { background: #b490d0; }
.pip-necromancer { background: #bf50e0; }
.pip-shadow-knight { background: #9545d0; }
.pip-rogue { background: #fff569; }
.pip-ranger { background: #abd473; }
.pip-druid { background: #ff7d0a; }
.pip-monk { background: #00ff96; }
.pip-bard { background: #f03070; }
.pip-paladin { background: #f58cba; }
.pip-shaman { background: #2890f0; }
.pip-warlock { background: #a898d8; }

/* ── Treemap (custom CSS: color-mix, absolute positioning) */

.treemap-cell {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: calc(var(--space-unit) / 2);
  padding: var(--space-unit) calc(var(--space-unit) * 1.5);
  background: color-mix(in srgb, var(--cell-color) calc(var(--opacity-4) * 100%), var(--color-surface));
  border: 1px solid color-mix(in srgb, var(--cell-color) 10%, transparent);
  cursor: pointer;
  overflow: hidden;
  transition: background var(--duration-fast) var(--ease-standard),
              border-color var(--duration-fast) var(--ease-standard),
              box-shadow var(--duration-fast) var(--ease-standard),
              opacity var(--duration-normal) var(--ease-standard),
              left var(--duration-slow) var(--ease-decelerate),
              top var(--duration-slow) var(--ease-decelerate),
              width var(--duration-slow) var(--ease-decelerate),
              height var(--duration-slow) var(--ease-decelerate);
}

.treemap-cell:hover {
  background: color-mix(in srgb, var(--cell-color) 28%, var(--color-surface));
  border-color: var(--cell-color);
  box-shadow: var(--shadow-md);
  z-index: 1;
}

.treemap-cell.active {
  background: color-mix(in srgb, var(--cell-color) 32%, var(--color-surface));
  border-color: var(--cell-color);
  box-shadow: var(--shadow-lg);
  z-index: 2;
}

.treemap-cell.dimmed {
  opacity: 0.35;
}
.treemap-cell.dimmed:hover {
  opacity: 0.6;
}

.treemap-label {
  font-family: var(--font-body);
  font-size: var(--font-size-caption);
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: var(--letter-spacing-overline);
  color: color-mix(in srgb, var(--cell-color) 80%, white);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: center;
  line-height: 1;
}

.treemap-count {
  font-family: var(--font-mono);
  font-size: var(--font-size-body);
  font-weight: 700;
  font-variant-numeric: tabular-nums;
  color: var(--cell-color);
  text-align: center;
  line-height: 1;
}

/* ── Treemap texture (horizontal lines) ───────────────── */

.treemap-texture::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: var(--opacity-1);
  background: repeating-linear-gradient(
    to bottom,
    transparent,
    transparent 3px,
    oklch(var(--lum-bg) 0 0 / 0.5) 3px,
    oklch(var(--lum-bg) 0 0 / 0.5) 4px
  );
  z-index: 2;
}


/* ── Grain overlay ────────────────────────────────────── */

.grain-overlay {
  isolation: isolate;
  position: relative;
}
.grain-overlay::after {
  content: '';
  position: absolute;
  inset: 0;
  z-index: 1;
  pointer-events: none;
  mix-blend-mode: overlay;
  opacity: var(--opacity-1);
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='grain'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23grain)'/%3E%3C/svg%3E");
  background-size: 512px 512px;
}

/* ── Collapse pattern (generic) ───────────────────────── */

.collapse-container {
  display: grid;
  grid-template-rows: 0fr;
  transition: grid-template-rows var(--duration-slow) var(--ease-decelerate);
}
.collapse-container[data-expanded="true"] {
  grid-template-rows: 1fr;
}
.collapse-container > .collapse-inner {
  overflow: hidden;
}
.collapse-chevron {
  transition: transform var(--duration-fast) var(--ease-standard);
}
.collapse-chevron[data-expanded="true"] {
  transform: rotate(90deg);
}

/* ── Readout status segments (data-driven colors) ─────── */

.readout-seg { transition: flex var(--duration-slow) var(--ease-standard); }
.readout-seg.status-main { background: var(--color-accent); }
.readout-seg.status-alt { background: var(--color-green); }
.readout-seg.status-bot { background: var(--color-yellow); }
.readout-seg.status-probationary { background: var(--color-text-dim); }

.readout-dot.status-main { background: var(--color-accent); }
.readout-dot.status-alt { background: var(--color-green); }
.readout-dot.status-bot { background: var(--color-yellow); }
.readout-dot.status-probationary { background: var(--color-text-dim); }

/* ── Chat background ─────────────────────────────────── */

.chat-bg {
  background: var(--color-surface);
}

/* ── Chat bubbles ────────────────────────────────────── */

.bubble-self {
  background: color-mix(in srgb, var(--color-accent) 14%, var(--color-surface));
  border: 1px solid color-mix(in srgb, var(--color-accent) 10%, var(--color-border-subtle));
}
.bubble-other {
  background: var(--color-surface-2);
  border: 1px solid var(--color-border-subtle);
}

/* ── Keyframes ────────────────────────────────────────── */

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* ── Pseudo-elements that can't be Tailwind utilities ── */

.message-command::before {
  content: '> ';
  color: var(--color-accent);
}

.loading::after {
  content: ' ';
  animation: pulse 1s ease-in-out infinite;
}

/* ── Field tooltip (CSS-only, design-token driven) ───── */

.field-tooltip {
  position: relative;
  cursor: help;
}
.field-tooltip::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: calc(100% + 4px);
  left: 0;
  padding: calc(var(--space-unit) / 2) var(--space-unit);
  background: var(--color-surface-3);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: var(--font-size-caption);
  color: var(--color-text-secondary);
  white-space: nowrap;
  box-shadow: var(--shadow-sm);
  z-index: var(--z-index-dropdown);
  opacity: 0;
  pointer-events: none;
  transition: opacity var(--duration-fast) var(--ease-decelerate);
  transition-delay: var(--duration-normal);
}
.field-tooltip:hover::after {
  opacity: 1;
}

/* ── Mobile overrides for treemap ─────────────────────── */

@media (width < 48rem) {
  .treemap-count { font-size: var(--font-size-caption); }
  .treemap-label { font-size: var(--font-size-micro); }
}
